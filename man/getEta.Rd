% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extractEstimates.R
\name{getEta}
\alias{getEta}
\title{Reconstruct posterior linear predictors \eqn{\eta} from a stanfit}
\usage{
getEta(fit, H = NULL, X = NULL, log_flag = 0, jittering = 0, offset = NULL)
}
\arguments{
\item{fit}{A fitted \code{rstan::stanfit} from \code{\link{getModel}}.}

\item{H}{Numeric matrix \eqn{n \times r} used in the fit (same ordering as during fitting).}

\item{X}{Optional numeric matrix of additional predictors (\eqn{n \times p_x}).
If supplied, \code{X0} is prepended; if \code{NULL}, \code{X} is just \code{X0}.}

\item{log_flag}{Integer \code{0/1}. If 1, applies \code{exp()} to reconstructed
\eqn{\eta} to invert the log link (to align with \code{log\_flag} used in fitting).}

\item{jittering}{Integer \code{0/1}. If 1, applies \code{floor()} to \eqn{\eta}
to mimic any integer-valued response post-processing used during fitting.}

\item{offset}{Optional numeric vector of length \eqn{n} added to \eqn{\eta}.
Defaults to zeros.}

\item{w}{Integer \(\ge 1\). Length of the initial step column \code{X0} (first \code{w} rows are 1).}
}
\value{
A list with two 3D arrays, each of dimension
  \code{[iterations, m, n]}:
\describe{
  \item{\code{eta_draws0}}{Without \eqn{X\beta}.}
  \item{\code{eta_draws1}}{With \eqn{X\beta}.}
}
}
\description{
Rebuilds the per-quantile, per-time linear predictors \eqn{\eta_{q,i}}
from posterior draws of \eqn{\mu}, \eqn{\beta}, and \eqn{\gamma}, using the
same design construction as in \code{\link{getModel}} (adds the \code{X0}
step column defined by \code{w} and prepends it to any supplied \code{X}).
}
\details{
The function pulls posterior arrays via \code{rstan::extract()}:
\itemize{
  \item \code{mu}: \code{[iterations, m, n]}
  \item \code{beta}: \code{[iterations, m, p]} (present only if \eqn{p > 0})
  \item \code{gamma}: \code{[iterations, m, r]} (present if \eqn{r > 0})
}
Two reconstructions are returned:
\describe{
  \item{\code{eta_draws0}}{\eqn{\mu + H\gamma + \mathrm{offset}} (ignoring \eqn{X\beta}).}
  \item{\code{eta_draws1}}{\eqn{\mu + X\beta + H\gamma + \mathrm{offset}} (full predictor).}
}
If \code{log_flag = 1}, both arrays are exponentiated. If \code{jittering = 1},
both arrays are \code{floor()}ed.
}
\examples{
\dontrun{
  et <- getEta(fit, H = H, w = 20, X = X, log_flag = 0, jittering = 0)
  dim(et$eta_draws1)   # iterations x m x n
  # Posterior median trajectory for the median quantile:
  med <- apply(et$eta_draws1[, 2, ], 2, median)
  plot(med, type = "l")
}

}
\seealso{
\code{\link{getModel}}, \code{\link{extractGamma}}
}
